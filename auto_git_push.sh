#!/bin/bash

# å°å°¼åœ°å›¾é€è´§æ•°æ®åŒæ­¥ç³»ç»Ÿ - è‡ªåŠ¨GitæŽ¨é€è„šæœ¬
# =====================================

echo "ðŸš€ å¼€å§‹æäº¤å°å°¼åœ°å›¾é€è´§æ•°æ®åŒæ­¥ç³»ç»Ÿåˆ°Gitä»“åº“..."

# æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–Gitä»“åº“
if [ ! -d ".git" ]; then
    echo "ðŸ“¦ åˆå§‹åŒ–Gitä»“åº“..."
    git init
    
    echo "ðŸ“ åˆ›å»º.gitignoreæ–‡ä»¶..."
    cat > .gitignore << 'EOF'
# ä¾èµ–æ–‡ä»¶
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# ç”Ÿäº§æž„å»º
/build
/dist

# çŽ¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# æ—¥å¿—æ–‡ä»¶
*.log
logs/

# ä¸´æ—¶æ–‡ä»¶
.DS_Store
.vscode/
.idea/
*.swp
*.swo
*~

# æµ‹è¯•è¦†ç›–çŽ‡
coverage/

# ç¼“å­˜
.cache/
.parcel-cache/

# é”æ–‡ä»¶ï¼ˆå¯é€‰ä¿ç•™ï¼‰
# package-lock.json
# yarn.lock

# é£žä¹¦åŒæ­¥æœåŠ¡çš„çŽ¯å¢ƒå˜é‡
feishu-sync-service/.env
feishu-sync-service/.env.*
!feishu-sync-service/env.example

# å…¶ä»–æ•æ„Ÿæ–‡ä»¶
config/secrets.js
config/production.env
EOF
    
    echo "âœ… .gitignoreæ–‡ä»¶åˆ›å»ºå®Œæˆ"
fi

# æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº
echo "ðŸ“ æ·»åŠ æ–‡ä»¶åˆ°Gitæš‚å­˜åŒº..."
git add .

# æäº¤æ›´æ”¹
echo "ðŸ’¾ æäº¤æ›´æ”¹åˆ°æœ¬åœ°ä»“åº“..."
git commit -m "ðŸšš å°å°¼åœ°å›¾é€è´§æ•°æ®åŒæ­¥ç³»ç»Ÿ

âœ¨ æ–°åŠŸèƒ½:
- é£žä¹¦è¡¨æ ¼æ•°æ®è‡ªåŠ¨åŒæ­¥ç³»ç»Ÿ
- æ¯æ—¥ä¸¤æ¬¡å®šæ—¶è¯»å–é€è´§æ•°æ®ï¼ˆ09:00å’Œ14:00ï¼‰
- å…¨äº‘ç«¯æž¶æž„ï¼ˆRender + GitHub + Netlifyï¼‰
- é€è´§åœ°ç‚¹ä¿¡æ¯æ˜¾ç¤ºï¼ˆåº—é“ºã€ç”µè¯ã€POç±»åž‹ã€æ—¥æœŸï¼‰
- åœ°å›¾/å«æ˜Ÿè§†å›¾åˆ‡æ¢åŠŸèƒ½
- ç”¨æˆ·ä½ç½®å®šä½åŠŸèƒ½
- æ€»éƒ¨ä½ç½®ç‰¹æ®Šæ ‡è®°

ðŸ”§ æŠ€æœ¯å®žçŽ°:
- é£žä¹¦å¼€æ”¾APIé›†æˆ
- Node.jså®šæ—¶ä»»åŠ¡æœåŠ¡
- GitHub APIè‡ªåŠ¨æ›´æ–°CSV
- Reactåœ°å›¾å‰ç«¯ä¼˜åŒ–
- å“åº”å¼è®¾è®¡

ðŸ“ æ–‡ä»¶ç»“æž„:
- feishu-sync-service/ (Renderäº‘æœåŠ¡)
- src/ (å‰ç«¯Reactåº”ç”¨)
- public/markers.csv (æ•°æ®æ–‡ä»¶)
- é…ç½®å’Œæ–‡æ¡£æ–‡ä»¶

ðŸŒŸ ç³»ç»Ÿç‰¹ç‚¹:
- å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€äººå·¥å¹²é¢„
- æ•°æ®å®žæ—¶åŒæ­¥
- ä¸“ä¸ºé€è´§è·¯çº¿ä¼˜åŒ–çš„ç•Œé¢
- æ”¯æŒæ‰‹æœºå’Œç”µè„‘è®¿é—®"

# æ£€æŸ¥æ˜¯å¦å·²é…ç½®è¿œç¨‹ä»“åº“
if ! git remote | grep -q "origin"; then
    echo ""
    echo "ðŸ”— é…ç½®è¿œç¨‹Gitä»“åº“..."
    echo "è¯·é€‰æ‹©Gitæ‰˜ç®¡å¹³å°ï¼š"
    echo "1) GitHub"
    echo "2) GitLab"
    echo "3) å…¶ä»–Gitå¹³å°"
    read -p "è¯·è¾“å…¥é€‰æ‹© (1-3): " choice
    
    case $choice in
        1)
            echo "ðŸ“˜ GitHubé…ç½®æŒ‡å—ï¼š"
            echo "1. è®¿é—® https://github.com/new"
            echo "2. åˆ›å»ºæ–°ä»“åº“ï¼Œä»“åº“åå»ºè®®ï¼šindonesia-delivery-map-system"
            echo "3. å¤åˆ¶ä»“åº“URL"
            ;;
        2)
            echo "ðŸ“™ GitLabé…ç½®æŒ‡å—ï¼š"
            echo "1. è®¿é—® https://gitlab.com/projects/new"
            echo "2. åˆ›å»ºæ–°é¡¹ç›®ï¼Œé¡¹ç›®åå»ºè®®ï¼šindonesia-delivery-map-system"
            echo "3. å¤åˆ¶é¡¹ç›®URL"
            ;;
        3)
            echo "ðŸ“— å…¶ä»–å¹³å°è¯·æ‰‹åŠ¨åˆ›å»ºä»“åº“"
            ;;
    esac
    
    echo ""
    read -p "ðŸ”— è¯·è¾“å…¥è¿œç¨‹ä»“åº“URL: " repo_url
    
    if [ -n "$repo_url" ]; then
        git remote add origin "$repo_url"
        echo "âœ… è¿œç¨‹ä»“åº“é…ç½®å®Œæˆ"
        
        # è®¾ç½®é»˜è®¤åˆ†æ”¯å
        git branch -M main
        
        # æŽ¨é€åˆ°è¿œç¨‹ä»“åº“
        echo "ðŸš€ æŽ¨é€åˆ°è¿œç¨‹ä»“åº“..."
        if git push -u origin main; then
            echo ""
            echo "ðŸŽ‰ æ­å–œï¼å°å°¼åœ°å›¾é€è´§æ•°æ®åŒæ­¥ç³»ç»Ÿå·²æˆåŠŸæŽ¨é€åˆ°Gitä»“åº“ï¼"
            echo ""
            echo "ðŸ“‹ ä¸‹ä¸€æ­¥éƒ¨ç½²æŒ‡å—ï¼š"
            echo "1. ðŸ“– æŸ¥çœ‹è¯¦ç»†éƒ¨ç½²è¯´æ˜Žï¼šé€è´§æ•°æ®åŒæ­¥éƒ¨ç½²æŒ‡å—.txt"
            echo "2. ðŸ”§ é…ç½®é£žä¹¦åº”ç”¨ï¼šé£žä¹¦APIé…ç½®æŒ‡å—.txt"
            echo "3. â˜ï¸ éƒ¨ç½²RenderæœåŠ¡ï¼šfeishu-sync-service/"
            echo "4. ðŸŒ éƒ¨ç½²Netlifyå‰ç«¯ï¼šå½“å‰ç›®å½•"
            echo ""
            echo "ðŸ”— ä»“åº“åœ°å€: $repo_url"
            echo "ðŸ“± ç³»ç»Ÿç‰¹ç‚¹: æ¯æ—¥è‡ªåŠ¨åŒæ­¥ï¼Œå…¨äº‘ç«¯è¿è¡Œ"
        else
            echo "âŒ æŽ¨é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š"
            echo "1. ä»“åº“URLæ˜¯å¦æ­£ç¡®"
            echo "2. æ˜¯å¦æœ‰æŽ¨é€æƒé™"
            echo "3. ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸"
        fi
    else
        echo "âš ï¸  æœªé…ç½®è¿œç¨‹ä»“åº“ï¼Œä»…æœ¬åœ°æäº¤å®Œæˆ"
    fi
else
    # å·²é…ç½®è¿œç¨‹ä»“åº“ï¼Œç›´æŽ¥æŽ¨é€
    echo "ðŸš€ æŽ¨é€åˆ°è¿œç¨‹ä»“åº“..."
    if git push; then
        echo ""
        echo "ðŸŽ‰ å°å°¼åœ°å›¾é€è´§æ•°æ®åŒæ­¥ç³»ç»Ÿæ›´æ–°å·²æŽ¨é€åˆ°Gitä»“åº“ï¼"
        echo ""
        echo "ðŸ“‹ ç³»ç»ŸçŠ¶æ€ï¼š"
        echo "âœ… å‰ç«¯åœ°å›¾åº”ç”¨å·²æ›´æ–°"
        echo "âœ… é£žä¹¦åŒæ­¥æœåŠ¡å·²æ›´æ–°"
        echo "âœ… é…ç½®æ–‡æ¡£å·²æ›´æ–°"
        echo ""
        echo "ðŸ”„ å¦‚éœ€é‡æ–°éƒ¨ç½²ï¼š"
        echo "1. RenderæœåŠ¡ä¼šè‡ªåŠ¨æ£€æµ‹æ›´æ–°"
        echo "2. Netlifyä¼šè‡ªåŠ¨é‡æ–°æž„å»º"
        echo "3. ç³»ç»Ÿå°†åœ¨ä¸‹æ¬¡å®šæ—¶ä»»åŠ¡æ—¶ç”Ÿæ•ˆ"
    else
        echo "âŒ æŽ¨é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥å’Œæƒé™"
    fi
fi

echo ""
echo "ðŸ“ Gitæ“ä½œå®Œæˆï¼"
