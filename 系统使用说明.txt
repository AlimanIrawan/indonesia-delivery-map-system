印尼雅加达送货路线优化系统使用说明
==========================================

🗺️ 系统概述
-----------
本系统是基于云端的印尼雅加达送货路线优化管理平台，集成飞书多维表格数据源，
通过Google Maps API实现智能路线规划，帮助优化送货效率。

🔧 核心功能
-----------
1. 自动数据同步
   - 每日9点和14点自动从飞书获取送货数据
   - 支持手动刷新数据功能
   - 数据实时更新到地图显示

2. 订单状态管理
   - 自动识别"Gudang OUT"字段为"✅"的已出库订单
   - 已出库订单以灰色虚线标记显示，不参与路线计算
   - 未出库订单以红色实心标记显示，参与路线优化

3. 智能路线优化
   - 基于TSP算法的路线优化
   - 支持车辆容量约束（80件货物限制）
   - 自动分批处理大量订单
   - 最近邻+2-opt算法优化

4. 可视化地图界面
   - 总部位置星形标记（固定在雅加达）
   - 多色路线显示（不同批次用不同颜色）
   - 详细统计信息面板
   - 支持标准地图和卫星视图切换

🚀 使用步骤
-----------
1. 登录系统
   用户名：One Meter
   密码：prioritaspelayanan

2. 查看订单状态
   - 左侧面板显示总订单数、参与计算和已出库订单统计
   - 地图上红色标记为待送货订单，灰色标记为已出库订单

3. 计算优化路线
   - 点击"🧮 计算路线"按钮
   - 系统自动过滤已出库订单，只对未出库订单进行路线计算
   - 计算完成后显示批次统计和路线图

4. 查看路线结果
   - 不同颜色的线条代表不同配送批次
   - 点击路线可查看批次详情（距离、时间、货物数量）
   - 批次图例显示各批次的站点数量

5. 手动更新数据
   - 点击"🔄 刷新数据"同步最新飞书数据
   - 系统有1分钟冷却时间防止频繁操作
   - 数据更新后旧路线自动清除

📊 路线优化算法说明
-----------------
1. 容量约束分批
   - 按距离总部远近排序订单
   - 每批最多80件货物（DUS数量）
   - 确保同批次地点相对集中

2. 单批次路线优化
   - 最近邻算法构建初始路线
   - 2-opt算法优化路线顺序
   - 计算实际距离和时间成本

3. Google Maps集成
   - 真实道路距离计算
   - 交通状况考虑
   - API调用缓存机制（1天有效期）

💡 系统特性
-----------
- 🌐 云端部署：Netlify前端 + Render后端
- 📱 响应式设计：支持桌面和移动设备
- 🔄 实时同步：飞书数据自动同步到GitHub
- 💰 成本优化：免费额度内运行，包含API缓存
- 🔒 安全访问：登录保护，会话管理
- 📍 精确定位：支持用户当前位置获取

⚠️ 注意事项
-----------
1. 环境变量要求
   - 飞书API密钥（FEISHU_APP_ID, FEISHU_APP_SECRET等）
   - Google Maps API密钥（GOOGLE_MAPS_API_KEY）
   - GitHub访问令牌（GITHUB_TOKEN）

2. 数据格式要求
   - 飞书表格必须包含：经纬度、货物数量、Gudang OUT字段
   - 坐标数据必须有效（非0值）
   - 日期格式为印尼雅加达时区

3. 使用限制
   - Google Maps API有调用量限制
   - 手动更新有1分钟冷却时间
   - 路线计算时间取决于订单数量

🔧 技术架构
-----------
前端：React + TypeScript + Leaflet地图
后端：Node.js + Express + 飞书API
优化：Google Maps API + TSP算法
部署：Netlify + Render
存储：GitHub仓库

📞 技术支持
-----------
如遇问题请检查：
1. 网络连接是否正常
2. 环境变量是否正确配置
3. 飞书数据格式是否符合要求
4. API调用是否超出限额

系统开发：AI Assistant
最后更新：2025年1月 